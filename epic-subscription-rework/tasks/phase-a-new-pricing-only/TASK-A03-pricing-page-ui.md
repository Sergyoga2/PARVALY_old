# TASK-A03: UI — новая страница тарифов

## Meta

| Поле | Значение |
|------|----------|
| ID | TASK-A03 |
| Title | Новая страница тарифов (pricing page) |
| Phase | A — New Pricing |
| Type | Frontend |
| Priority | P0 |
| Estimate | M (3 дня) |
| Owner Role | Frontend Developer |

---

## Goal / Why

Заменить текущую страницу с 3 тарифами на новую с 4 тарифами (1/3/6/12 мес). Страница должна ясно коммуницировать ценность каждого тарифа, выделять рекомендованный (6 мес), показывать экономию и в будущем поддерживать CTA trial (Phase B).

---

## Scope

- Верстка новой страницы тарифов (4 карточки)
- Для каждого тарифа: цена/мес, общая стоимость, скидка в %, экономия в ₽
- Визуальное выделение тарифа 6 мес как «Выбор большинства»
- Маркировка 12 мес как «Максимум выгоды»
- Feature flag для переключения между старой и новой страницей
- Адаптивность (desktop + mobile)
- Подготовка места для Trial CTA (placeholder, скрыт за flag в Phase A)

## Out of Scope

- Trial CTA (Phase B)
- Payment flow / checkout (A04)
- Cancellation flow (Phase C)

---

## Dependencies

| Зависимость | Тип |
|-------------|-----|
| TASK-A01 | API / данные по тарифам (план, цена, скидка) |
| Дизайн-макеты | Внешняя (дизайнер) |

---

## Detailed Implementation Notes

### 1. Layout

```
[Hero Section]
  Заголовок: "Изучайте программирование с полным доступом к 56 навыкам"
  Подзаголовок: (placeholder для trial CTA — скрыт в Phase A)

[Pricing Cards Section]
  4 карточки в ряд (desktop) / вертикально (mobile)

  Каждая карточка:
    - Название тарифа (1 мес / 3 мес / 6 мес / 12 мес)
    - Badge (если есть): «Выбор большинства» / «Максимум выгоды»
    - Цена за месяц (крупно)
    - Скидка в % (если есть)
    - Общая стоимость (если > 1 мес)
    - Экономия в ₽ (если есть)
    - CTA кнопка "Оформить"

[Features Section]
  ✓ Доступ ко всем 56 навыкам
  ✓ Практика в браузере
  ✓ Отмена в любой момент
```

### 2. Данные карточек

| Тариф | Badge | Цена/мес | Скидка | Итого | Экономия |
|-------|-------|----------|--------|-------|----------|
| 1 мес | — | 3 900 ₽ | — | — | — |
| 3 мес | — | 3 300 ₽ | -15% | 9 900 ₽ | 1 800 ₽ |
| 6 мес | Выбор большинства | 2 900 ₽ | -26% | 17 400 ₽ | 6 000 ₽ |
| 12 мес | Максимум выгоды | 2 400 ₽ | -38% | 28 800 ₽ | 18 000 ₽ |

### 3. Feature Flag

```javascript
// Проверяем flag
if (featureFlag.isEnabled('new_pricing_page')) {
  renderNewPricingPage();
} else {
  renderLegacyPricingPage();
}
```

Старая страница **не удаляется** — остаётся для rollback.

### 4. Подготовка для Trial (Phase B)

Добавить в hero-section скрытый блок:

```html
<div id="trial-hero" style="display: none;">
  <!-- Будет активирован в Phase B -->
  <h2>Попробуйте 7 дней бесплатно</h2>
  <p>Полный доступ ко всем навыкам. Без ограничений.</p>
  <button>Начать бесплатно</button>
  <small>После пробного периода — 3 900 ₽/мес. Отменить можно в любой момент.</small>
</div>
```

### 5. Отображение для legacy-подписчиков

Если пользователь авторизован и имеет legacy-подписку:
- Показать баннер: «У вас тариф [Legacy Monthly]. Доступны новые тарифы со скидками»
- Кнопки тарифов: «Перейти на этот тариф» (вместо «Оформить»)

### 6. Адаптивность

- Desktop (>1024px): 4 карточки в ряд
- Tablet (768-1024px): 2×2 grid
- Mobile (<768px): вертикальный список, 6 мес карточка первая (выделенная)

---

## UI States Covered

| Состояние пользователя | Что видит |
|------------------------|-----------|
| Неавторизованный | 4 тарифа, CTA → redirect на регистрацию |
| Авторизованный, нет подписки | 4 тарифа, CTA → checkout |
| Авторизованный, active подписка (new) | Текущий тариф выделен, остальные «Перейти» |
| Авторизованный, active подписка (legacy) | Баннер legacy + 4 новых тарифа |
| Авторизованный, cancelled (доступ есть) | 4 тарифа, «Переоформить» |
| Авторизованный, expired | 4 тарифа, «Оформить» |

---

## Edge Cases / Failure Cases

1. **API тарифов не отвечает:** показать cached данные или fallback на hardcoded цены
2. **Пользователь с legacy 3-year планом:** показать все 4 новых тарифа, в баннере указать текущий тариф
3. **Пользователь с ACTIVE подпиской нажимает «Оформить» на другой тариф:** redirect на upgrade flow (или сообщение «сначала отмените текущий»)

---

## Acceptance Criteria

- **Given** новый пользователь, **When** открывает pricing page, **Then** видит 4 карточки тарифов с корректными ценами
- **Given** feature flag off, **When** открывает pricing page, **Then** видит старую страницу
- **Given** тариф 6 мес, **When** отображается, **Then** имеет badge «Выбор большинства» и визуально выделен
- **Given** mobile устройство, **When** открывает pricing page, **Then** карточки отображаются вертикально
- **Given** legacy-подписчик, **When** открывает pricing page, **Then** видит баннер о текущем тарифе и новые тарифы

---

## Test Cases

### E2E Tests
- Pricing page загружается, 4 карточки отображаются
- Цены соответствуют данным из API
- Feature flag toggle: old/new page
- Mobile responsive: карточки stack вертикально
- CTA клик: redirect на checkout/registration

### Manual Tests
- Визуальная проверка по макету (desktop, tablet, mobile)
- Проверка всех состояний пользователя
- Cross-browser: Chrome, Firefox, Safari

---

## Analytics Events Impacted

- `pricing_page_viewed` {user_id?, user_state, source}
- `pricing_plan_selected` {user_id?, plan_months, plan_price}

---

## Risks

| Риск | Митигация |
|------|-----------|
| Дизайн-макеты задерживаются | Начать с wireframe, итерировать |
| Старая страница сломалась при деплое новой | Feature flag, старая страница не изменяется |
