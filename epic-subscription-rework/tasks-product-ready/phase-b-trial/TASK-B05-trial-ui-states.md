# TASK-B05: UI — trial-состояния на pricing page и в ЛК

## Meta

| Поле | Значение |
|------|----------|
| ID | TASK-B05 |
| Title | UI: trial CTA на pricing page и trial-состояния в ЛК |
| Phase | B — Trial |
| Priority | P0 |

---

## A) Краткое описание

Показать trial CTA на pricing page (hero section, подготовленный в Phase A) и корректно отображать все trial-состояния в личном кабинете. UI должен корректно реагировать на все возможные состояния пользователя: от неавторизованного до grace period.

---

## B) Scope / Out of Scope

### Scope
- Активация скрытого trial hero section на pricing page (из Phase A)
- Условное отображение trial CTA в зависимости от состояния пользователя
- Интеграция с виджетом провайдера для ввода карты при trial
- ЛК: trial active (оставшиеся дни, прогресс-бар, кнопки upgrade/cancel)
- ЛК: trial cancelled (дата окончания доступа, CTA на тарифы)
- ЛК: grace period (проблема с оплатой, кнопка обновить карту)

### Out of Scope
- Cancellation flow (Phase C)
- Pause UI (Phase D)

---

## C) Бизнес-правила и состояния

### Условия показа trial CTA на pricing page
- Неавторизованный → показать (redirect на регистрацию при клике)
- Авторизован, trial доступен (не использован, нет подписки) → показать
- Авторизован, trial использован → НЕ показывать
- Авторизован, есть active/cancelled/paused подписка → НЕ показывать

### Состояния и отображение

| Состояние | Pricing Page | ЛК |
|-----------|-------------|-----|
| Неавторизован | Trial CTA + 4 тарифа | — |
| Trial доступен, нет подписки | Trial CTA + 4 тарифа | «Нет подписки» |
| Trial использован, нет подписки | 4 тарифа (без trial CTA) | «Нет подписки» |
| Trial active | 4 тарифа (upgrade) | Прогресс trial + cancel |
| Trial cancelled (доступ есть) | 4 тарифа | «Отменён, доступ до…» |
| Grace period | 4 тарифа | «Проблема с оплатой» |
| Active (new) | 4 тарифа (upgrade) | Тариф + cancel |
| Legacy | 4 тарифа + баннер | Legacy state |

### Trial activation UI flow
1. Клик «Начать бесплатно» → (если не авторизован: регистрация → возврат)
2. Форма: описание trial (7 дней, полный доступ, 3 900 ₽/мес после), виджет ввода карты, согласие с условиями
3. Success: «Trial активирован! 7 дней бесплатно. Напомним за 24 часа.»

### ЛК: Trial Active
- Статус: «Пробный период»
- Осталось: X дней (до [дата])
- Прогресс-бар: N/7 дней
- После trial: 3 900 ₽/мес
- Кнопки: «Выбрать тариф со скидкой» → pricing, «Отменить пробный период»

### ЛК: Grace Period
- Предупреждение: «Проблема с оплатой»
- «Не удалось списать 3 900 ₽. Повторим попытку [дата].»
- Кнопка «Обновить данные карты»

---

## D) Пользовательские и системные сценарии

1. **Given** новый неавторизованный пользователь, **When** pricing page, **Then** trial CTA отображается.

2. **Given** пользователь с trial_used=true, **When** pricing page, **Then** trial CTA НЕ отображается.

3. **Given** trial активен, **When** ЛК, **Then** показан прогресс-бар, оставшиеся дни, кнопки upgrade/cancel.

4. **Given** trial отменён (доступ есть), **When** ЛК, **Then** показана дата окончания, CTA на тарифы.

5. **Given** grace period, **When** ЛК, **Then** показана проблема с оплатой, кнопка обновить карту.

6. **Given** неавторизованный, **When** клик trial CTA, **Then** redirect на регистрацию → возврат на pricing.

7. **Given** авторизованный, trial доступен, **When** клик trial CTA, **Then** форма ввода карты.

8. **Given** trial active, день 2, **When** ЛК, **Then** прогресс-бар показывает 2/7, осталось 5 дней.

9. **Given** mobile устройство, **When** trial CTA и ЛК, **Then** адаптивное отображение.

10. **Given** загрузка страницы, **When** проверяется trial eligibility, **Then** нет «мигания» (flickering) между состояниями.

---

## E) Acceptance Criteria

- [ ] Trial CTA отображается для eligible пользователей, скрыт для остальных
- [ ] Activation flow: CTA → (регистрация) → ввод карты → success page
- [ ] ЛК: trial active с прогресс-баром и корректными данными
- [ ] ЛК: trial cancelled с датой окончания доступа
- [ ] ЛК: grace period с предупреждением и кнопкой обновить карту
- [ ] Нет flickering при загрузке (состояние определяется до рендера)
- [ ] Адаптивность: desktop + mobile

---

## F) Аналитика/события

| Событие | Обязательные свойства |
|---------|----------------------|
| `trial_cta_clicked` | user_id (nullable), user_state, page |
| `trial_card_entered` | user_id |
| `trial_activation_success_page_viewed` | user_id |

---

## G) Риски и допущения (Assumptions)

### Допущения
- Дизайн-макеты будут предоставлены
- Hero section из Phase A готов к активации (скрытый блок)

### Риски
- Виджет провайдера может не вписываться в дизайн → кастомизация CSS
- State flickering при загрузке → серверный рендеринг состояния или loading skeleton

---

## H) Open questions для CTO/разработчиков

1. Как определять trial eligibility на стороне клиента: API-запрос или данные в серверном рендере?
2. Trial activation: отдельная страница, модальное окно, или inline на pricing page?
3. Как стилизовать виджет провайдера: есть ли опции кастомизации?
4. Нужен ли loading skeleton для предотвращения flickering?
5. Как обновляется прогресс-бар trial: при каждой загрузке страницы или по таймеру?
6. Куда ведёт кнопка «Обновить карту» при grace period: в виджет провайдера или на внешнюю страницу?
7. Нужно ли показывать trial CTA в мобильном приложении (если есть)?
8. Какой текст в hero section: финальный или placeholder?
9. Нужна ли анимация/micro-interaction при активации trial?
10. Как обрабатывать ситуацию, когда API trial eligibility не отвечает?

---

## I) Что убрано из исходника

- **HTML/CSS разметка** и конкретные wireframe-ы → заменены на описание элементов и состояний
- **JavaScript-код** виджета и feature flag → убран
- **Конкретные CSS-классы и стили** → убраны
- **Test Cases (E2E, Manual)** → трансформированы в Acceptance Criteria и сценарии
