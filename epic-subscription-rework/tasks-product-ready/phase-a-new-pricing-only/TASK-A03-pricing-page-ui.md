# TASK-A03: Новая страница тарифов

## Meta

| Поле | Значение |
|------|----------|
| ID | TASK-A03 |
| Title | Новая страница тарифов (pricing page) |
| Phase | A — New Pricing |
| Priority | P0 |

---

## A) Краткое описание

Заменить текущую страницу тарифов (3 тарифа) на новую (4 тарифа: 1/3/6/12 месяцев). Страница должна ясно показывать ценность каждого тарифа, визуально выделять рекомендованный (6 мес), показывать экономию. В будущем (Phase B) на странице появится CTA для trial — под него необходимо подготовить место.

Страница предназначена для всех пользователей: неавторизованных (привлечение), авторизованных без подписки (конверсия), с подпиской (информация и upgrade), с legacy-подпиской (информация о новых тарифах).

---

## B) Scope / Out of Scope

### Scope
- Вёрстка новой страницы с 4 карточками тарифов
- Для каждого тарифа: цена/мес, общая стоимость, скидка в %, экономия в ₽
- Визуальное выделение тарифа 6 мес — бейдж «Выбор большинства»
- Маркировка 12 мес — бейдж «Максимум выгоды»
- Feature flag для переключения между старой и новой страницей (старая не удаляется)
- Адаптивность: desktop, tablet, mobile
- Подготовка скрытого блока для Trial CTA (активируется в Phase B)
- Различное отображение для разных состояний пользователя (см. сценарии)

### Out of Scope
- Trial CTA (активация — Phase B)
- Payment flow / checkout (A04)
- Cancellation flow (Phase C)

---

## C) Бизнес-правила и состояния

### Данные карточек

| Тариф | Бейдж | Цена/мес | Скидка | Итого | Экономия |
|-------|-------|----------|--------|-------|----------|
| 1 мес | — | 3 900 ₽ | — | — | — |
| 3 мес | — | 3 300 ₽ | -15% | 9 900 ₽ | 1 800 ₽ |
| 6 мес | Выбор большинства | 2 900 ₽ | -26% | 17 400 ₽ | 6 000 ₽ |
| 12 мес | Максимум выгоды | 2 400 ₽ | -38% | 28 800 ₽ | 18 000 ₽ |

### Состояния пользователя → отображение

| Состояние пользователя | Что видит |
|------------------------|-----------|
| Неавторизованный | 4 тарифа, CTA → redirect на регистрацию |
| Авторизованный, нет подписки | 4 тарифа, CTA → checkout |
| Active подписка (new) | Текущий тариф выделен, остальные «Перейти» |
| Active подписка (legacy) | Баннер «У вас архивный тариф» + 4 новых тарифа |
| Cancelled (доступ есть) | 4 тарифа, «Переоформить» |
| Expired | 4 тарифа, «Оформить» |

### Адаптивность
- Desktop (>1024px): 4 карточки в ряд
- Tablet (768-1024px): 2×2
- Mobile (<768px): вертикальный список, 6 мес карточка первая

---

## D) Пользовательские и системные сценарии

1. **Given** новый неавторизованный пользователь, **When** открывает pricing page, **Then** видит 4 карточки тарифов с корректными ценами, скидками и экономией.

2. **Given** feature flag выключен, **When** пользователь открывает pricing page, **Then** видит старую страницу тарифов.

3. **Given** feature flag включен, **When** пользователь открывает pricing page, **Then** видит новую страницу с 4 тарифами.

4. **Given** тариф 6 мес, **When** отображается на странице, **Then** имеет бейдж «Выбор большинства» и визуально выделен.

5. **Given** мобильное устройство, **When** открывает pricing page, **Then** карточки отображаются вертикально, карточка 6 мес первая.

6. **Given** legacy-подписчик, **When** открывает pricing page, **Then** видит баннер о текущем тарифе (с пометкой «архивный») и все 4 новых тарифа.

7. **Given** пользователь с active подпиской на новый тариф, **When** открывает pricing page, **Then** текущий тариф выделен, на остальных кнопка «Перейти».

8. **Given** неавторизованный пользователь, **When** нажимает CTA на тарифе, **Then** redirect на регистрацию с возвратом на pricing page.

9. **Given** API тарифов не отвечает, **When** страница загружается, **Then** отображаются cached/fallback данные.

10. **Given** пользователь с legacy 3-year тарифом, **When** открывает pricing page, **Then** видит все 4 новых тарифа и баннер с текущим тарифом.

---

## E) Acceptance Criteria

- [ ] 4 карточки тарифов отображаются с корректными ценами, скидками и экономией
- [ ] Карточка 6 мес визуально выделена бейджем «Выбор большинства»
- [ ] Feature flag: при выключении показывается старая страница, при включении — новая
- [ ] Страница корректно отображается на desktop, tablet и mobile
- [ ] Для каждого состояния пользователя отображение соответствует таблице состояний
- [ ] Legacy-подписчик видит баннер «архивный тариф» + ссылку на новые тарифы
- [ ] Скрытый блок для Trial CTA присутствует (для Phase B)
- [ ] CTA для неавторизованных ведёт на регистрацию
- [ ] Старая страница тарифов не удалена (для rollback)

---

## F) Аналитика/события

| Событие | Обязательные свойства |
|---------|----------------------|
| `pricing_page_viewed` | user_id (null если не авториз.), user_state (none/active/cancelled/expired/legacy), source |
| `pricing_plan_selected` | user_id, plan_months, plan_price |

---

## G) Риски и допущения (Assumptions)

### Допущения
- Дизайн-макеты будут предоставлены до начала реализации
- Данные по тарифам берутся из API (не захардкожены)
- Старая страница остаётся для быстрого rollback через feature flag

### Риски
- Задержка дизайн-макетов → начинать с wireframe, итерировать
- Feature flag инфраструктура может быть не готова → уточнить у команды

---

## H) Open questions для CTO/разработчиков

1. Какую инфраструктуру feature flags использовать: существующую или нужно выбрать/создать?
2. Откуда берутся данные для карточек тарифов: API-endpoint, серверный рендеринг, или конфиг?
3. Есть ли дизайн-макеты? Если нет — по какому шаблону/дизайн-системе верстать?
4. Нужно ли кэшировать данные тарифов на клиенте? Какой fallback при недоступности API?
5. Как обрабатывать клик «Перейти» для пользователя с active подпиской — redirect на upgrade flow или сообщение «сначала отмените»?
6. Нужен ли серверный рендеринг (SSR) для SEO pricing page?
7. Какие браузеры поддерживаются? Минимальные требования?
8. Блок для Trial CTA — какого размера, с каким текстом-заглушкой?
9. Legacy-подписчик с 3-year тарифом видит предупреждение о потере профессий при переходе?
10. Нужно ли A/B тестирование разных вариантов pricing page?

---

## I) Что убрано из исходника

- **HTML/CSS-разметка** (конкретные теги, `display:none`, breakpoints) → заменены на требования к адаптивности
- **JavaScript-код** feature flag (`featureFlag.isEnabled('new_pricing_page')`) → заменён на требование «feature flag для переключения»
- **HTML-заглушка trial** (`<div id="trial-hero" style="display:none">`) → заменена на «скрытый блок для Trial CTA»
- **Конкретные CSS breakpoints** (1024px, 768px) → заменены на описание поведения для desktop/tablet/mobile
- **Test Cases** → трансформированы в Acceptance Criteria и сценарии
