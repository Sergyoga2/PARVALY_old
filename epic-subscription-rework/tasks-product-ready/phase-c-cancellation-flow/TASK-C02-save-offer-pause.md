# TASK-C02: Удерживающее предложение — пауза

## Meta

| Поле | Значение |
|------|----------|
| ID | TASK-C02 |
| Title | Save-offer: предложение паузы вместо отмены |
| Phase | C — Cancellation Flow |
| Priority | P1 |

---

## A) Краткое описание

При выборе причины отмены «Нет времени» (`no_time`) пользователю показывается удерживающее предложение: поставить подписку на паузу на 1 месяц вместо полной отмены. Цель — снизить churn среди пользователей, которые планируют вернуться, но сейчас не пользуются сервисом.

Данная задача охватывает только интерфейсную часть предложения паузы. Фактическая логика приостановки подписки (взаимодействие с платёжным провайдером, управление статусом) реализуется в отдельной задаче (D01). Если функциональность паузы ещё не готова, интерфейс должен корректно обрабатывать этот случай через fallback-сообщение. Если пользователь уже исчерпал лимит пауз, экран с предложением пропускается.

---

## B) Scope / Out of Scope

### Scope
- UI экрана предложения паузы (шаг 2 флоу отмены для причины `no_time`)
- Кнопка «Приостановить на 1 месяц» (основное действие) и «Всё равно отменить» (второстепенное действие)
- Проверка доступности функциональности паузы (готовность D01)
- Fallback-сообщение, если функциональность паузы недоступна
- Проверка лимита пауз: если исчерпан — пропуск экрана, переход к подтверждению (C05)
- Адаптивный дизайн (desktop + mobile)

### Out of Scope
- Логика приостановки подписки на стороне платёжного провайдера (D01)
- Управление статусом PAUSED (D01)
- Уведомления о паузе и возобновлении (D01)
- Экран подтверждения отмены (C05)
- Аналитические события флоу отмены (C06)

---

## C) Бизнес-правила и состояния

### Условия показа предложения паузы
- Причина отмены: `no_time`
- Пользователь НЕ на пробном периоде (trial → пропуск save-offer, правило из C01)
- Лимит пауз не исчерпан

### Лимит пауз
- Пользователь может использовать паузу ограниченное количество раз (конкретный лимит — open question)
- Если лимит исчерпан — экран паузы пропускается, пользователь переходит к подтверждению (C05)
- Информация о доступности паузы запрашивается до отображения экрана

### Действия пользователя

| Действие | Результат |
|----------|-----------|
| Нажал «Приостановить на 1 месяц» (D01 готов) | Вызывается функциональность паузы, подписка приостанавливается |
| Нажал «Приостановить на 1 месяц» (D01 НЕ готов) | Показывается fallback-сообщение: «Функция временно недоступна, мы работаем над ней» |
| Нажал «Всё равно отменить» | Переход к экрану подтверждения отмены (C05) |
| Нажал «Назад» | Возврат к экрану выбора причины (C01, шаг 1) |

### Визуальное оформление
- «Приостановить на 1 месяц» — основная кнопка (primary)
- «Всё равно отменить» — второстепенная кнопка (ghost / text)
- Пояснительный текст: что произойдёт при паузе (подписка заморозится, доступ сохранится / не сохранится — open question)

---

## D) Пользовательские и системные сценарии

1. **Given** пользователь выбрал причину `no_time` и лимит пауз не исчерпан, **When** переходит на шаг 2, **Then** видит экран с предложением паузы: кнопка «Приостановить на 1 месяц» и «Всё равно отменить».

2. **Given** пользователь выбрал причину `no_time` и лимит пауз исчерпан, **When** переходит на шаг 2, **Then** экран паузы пропускается, пользователь попадает на экран подтверждения (C05).

3. **Given** пользователь на экране паузы, функциональность D01 готова, **When** нажимает «Приостановить на 1 месяц», **Then** подписка приостанавливается, пользователь видит подтверждение паузы.

4. **Given** пользователь на экране паузы, функциональность D01 НЕ готова, **When** нажимает «Приостановить на 1 месяц», **Then** видит fallback-сообщение о временной недоступности функции.

5. **Given** пользователь на экране паузы, **When** нажимает «Всё равно отменить», **Then** переходит к экрану подтверждения отмены (C05).

6. **Given** пользователь на экране паузы, **When** нажимает «Назад», **Then** возвращается к экрану выбора причины (шаг 1), ранее выбранная причина сохранена.

7. **Given** пользователь на пробном периоде (trial) с причиной `no_time`, **When** переходит далее, **Then** экран паузы пропускается (правило из C01).

8. **Given** пользователь на мобильном устройстве, **When** видит экран паузы, **Then** все элементы корректно отображаются, кнопки доступны без прокрутки.

9. **Given** пользователь нажал «Приостановить» и D01 готов, но запрос завершился ошибкой, **When** ошибка обработана, **Then** пользователь видит сообщение об ошибке с возможностью повторить или продолжить отмену.

10. **Given** пользователь с уже приостановленной подпиской (статус PAUSED), **When** пытается отменить, **Then** экран паузы пропускается (пауза уже активна).

11. **Given** fallback-сообщение отображено, **When** пользователь хочет продолжить, **Then** доступна кнопка перехода к подтверждению отмены.

12. **Given** пользователь использовал паузу ранее и она завершилась, лимит не исчерпан, **When** снова выбирает причину `no_time`, **Then** предложение паузы отображается повторно.

---

## E) Acceptance Criteria

- [ ] При причине `no_time` (и доступности паузы) отображается экран с предложением приостановить подписку
- [ ] Кнопка «Приостановить на 1 месяц» является основным действием (primary)
- [ ] Кнопка «Всё равно отменить» является второстепенным действием (ghost)
- [ ] При исчерпанном лимите пауз экран пропускается, пользователь переходит к подтверждению
- [ ] При недоступности функциональности паузы (D01 не готов) показывается fallback-сообщение
- [ ] При ошибке выполнения паузы пользователь видит понятное сообщение об ошибке
- [ ] Кнопка «Назад» возвращает на шаг выбора причины
- [ ] Экран корректно отображается на desktop и mobile
- [ ] Для пользователей с активной паузой экран предложения паузы пропускается

---

## F) Аналитика/события

| Событие | Обязательные свойства |
|---------|----------------------|
| `save_offer_shown` | user_id, subscription_id, offer_type: `pause`, reason_code: `no_time` |
| `save_offer_accepted` | user_id, subscription_id, offer_type: `pause` |
| `save_offer_rejected` | user_id, subscription_id, offer_type: `pause` |
| `save_offer_skipped` | user_id, subscription_id, offer_type: `pause`, skip_reason: `limit_exhausted` / `feature_unavailable` |

Подробная аналитика — в задаче C06.

---

## G) Риски и допущения (Assumptions)

### Допущения
- Функциональность паузы (D01) может быть не готова к моменту релиза C02 — предусмотрен fallback
- Информация о лимите пауз доступна через внутренний запрос (не требует обращения к платёжному провайдеру)
- Платёжный провайдер нативно поддерживает статус «Приостановлена» — подтверждено из документации
- Длительность паузы фиксирована — 1 месяц (не выбирается пользователем)

### Риски
- Зависимость от D01: если D01 задерживается, экран паузы будет работать только в режиме fallback, что снижает retention-эффект
- Неясность с доступом во время паузы (сохраняется или нет) может повлиять на текст и дизайн экрана
- Лимит пауз не определён — может потребовать доработки после продуктового решения

---

## H) Open questions для CTO/разработчиков

1. Сколько раз пользователь может воспользоваться паузой? Какой лимит: 1 раз за всё время, 1 раз в N месяцев, без лимита?
2. Сохраняется ли доступ к контенту во время паузы или полностью блокируется?
3. Как определять готовность функциональности D01 в runtime: через feature flag, проверку доступности модуля или другим способом?
4. Что происходит с оплаченным периодом при паузе: замораживается (сдвигается дата окончания) или продолжает «тикать»?
5. Можно ли отменить паузу досрочно (возобновить подписку раньше)?
6. Нужно ли показывать пользователю, сколько пауз у него осталось?
7. Какой текст показывать на экране паузы? Нужны ли дизайн-макеты или можно использовать стандартный шаблон?
8. Fallback-сообщение при недоступности D01 — какой тон: «скоро появится» или «обратитесь в поддержку»?
9. Если пользователь нажал «Приостановить», но закрыл страницу до ответа — как обрабатывать незавершённый запрос?
10. Нужно ли логировать показ fallback-сообщения отдельным событием для отслеживания спроса на паузу до готовности D01?
11. Как обрабатывать ситуацию, когда подписка истекает в ближайшие дни — имеет ли смысл предлагать паузу?
12. Пауза применяется сразу или с начала следующего биллингового периода?
13. Для мультимесячных тарифов (3/6/12 мес) пауза тоже доступна или только для месячных?
14. Нужен ли отдельный экран подтверждения паузы или достаточно inline-уведомления об успехе?

---

## I) Что убрано из исходника

- **Ссылка на конкретный API паузы** (`call pause API`) → заменена на «вызывается функциональность паузы»
- **Упоминание конкретной задачи backend** (D01 API) → оставлена только как зависимость, без деталей реализации
- **Детали реализации fallback** → заменены на бизнес-требование «показать fallback-сообщение»
- **Конкретные названия кнопок в контексте реализации** → оставлены как продуктовые требования к UX
