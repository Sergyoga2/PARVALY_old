---
import BaseLayout from '../layouts/BaseLayout.astro';
import SEO from '../components/SEO.astro';
import BlogCard from '../components/BlogCard.astro';
import Pagination from '../components/Pagination.astro';
import { getPublishedPosts, paginateArray, POSTS_PER_PAGE, SITE_TITLE, SITE_DESCRIPTION } from '../utils/blog';

const posts = await getPublishedPosts();
const { data, totalPages } = paginateArray(posts, 1, POSTS_PER_PAGE);
const base = import.meta.env.BASE_URL;
---

<BaseLayout class="listing-page">
  <Fragment slot="head">
    <SEO
      title={SITE_TITLE}
      description={SITE_DESCRIPTION}
      canonical="https://parvaly.com/blog/"
      nextPage={totalPages > 1 ? `https://parvaly.com/blog/page/2/` : undefined}
    />
  </Fragment>

  <div class="listing-container">
    <header class="listing-header">
      <h1>Blog</h1>
      <p>{SITE_DESCRIPTION}</p>
    </header>

    <div class="post-list">
      {data.map(post => <BlogCard post={post} />)}
    </div>

    <Pagination currentPage={1} totalPages={totalPages} baseUrl={base} />
  </div>
</BaseLayout>
